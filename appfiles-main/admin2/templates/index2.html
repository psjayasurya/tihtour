<!DOCTYPE html>
<html>
<head>
    <title>Update Hotspot</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background-color: #fa9804; color: #fff; }
        form { background: rgba(0,0,0,0.6); padding: 20px; border-radius: 10px; width: fit-content; }
        label { display: block; margin-top: 10px; }
        input, select, textarea { width: 300px; padding: 5px; margin-top: 5px; border-radius: 5px; border: none; }
        button { margin-top: 20px; padding: 10px 20px; border: none; border-radius: 5px; background: #4CAF50; color: white; font-size: 16px; cursor: pointer; }
        button:hover { background: #45a049; }
        #response { margin-top: 20px; font-weight: bold; color: lightgreen; white-space: pre-wrap; }
    </style>
</head>
<body>

<form id="updateForm" enctype="multipart/form-data">
    <label>Update Info Hotspot</label>
    
    <label>Scene ID (required):</label>
    <select id="scene_id" name="scene_id" required>
        <option value="">--Select Scene--</option>
    </select>

    <label>Title to filter (optional):</label>
    <select id="title" name="title">
        <option value="">--Select Title--</option>
    </select>

    <label>New Photo (optional):</label>
    <input type="file" id="new_photo" name="new_photo" accept="image/*">

    <label>New Photo Title (optional):</label>
    <input type="text" id="new_photo_title" name="new_photo_title">

    <label>New Title (optional):</label>
    <input type="text" id="new_title" name="new_title">

    <label>New Yaw:</label>
    <input type="number" step="any" id="yaw" name="yaw">

    <label>New Pitch:</label>
    <input type="number" step="any" id="pitch" name="pitch">

    <label>New Text:</label>
    <textarea id="text" name="text"></textarea>

    <button type="submit">Update Hotspot</button>
</form>

<div id="response"></div>

<script>
// Load Scene IDs
async function loadSceneIDs() {
    try {
        const res = await fetch("/admin2/scene_ids");
        const ids = await res.json();
        const select = document.getElementById("scene_id");
        ids.forEach(id => {
            const option = document.createElement("option");
            option.value = id;
            option.textContent = id;
            select.appendChild(option);
        });
    } catch(err) {
        console.error("Failed to load scene IDs:", err);
    }
}

// Load Titles when a scene is selected
async function loadTitles(sceneId) {
    const titleSelect = document.getElementById("title");
    titleSelect.innerHTML = '<option value="">--Select Title--</option>';
    if (!sceneId) return;

    try {
        const res = await fetch(`/admin2/titles/${sceneId}`);
        const titles = await res.json();
        titles.forEach(title => {
            const option = document.createElement("option");
            option.value = title;
            option.textContent = title;
            titleSelect.appendChild(option);
        });
    } catch(err) {
        console.error("Failed to load titles:", err);
    }
}

document.getElementById("scene_id").addEventListener("change", function() {
    loadTitles(this.value);
});

// Submit form
document.getElementById("updateForm").addEventListener("submit", async function(e){
    e.preventDefault();

    const formData = new FormData(this);

    try {
        const res = await fetch("/admin2/update_hotspot", {
            method: "POST",
            body: formData
        });

        const result = await res.json();
        document.getElementById("response").innerText = JSON.stringify(result, null, 2);
    } catch(err) {
        document.getElementById("response").innerText = "Error: " + err;
    }
});

// Initialize dropdowns
loadSceneIDs();
</script>

</body>
</html>
